<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timetable Management</title>
    <link rel="stylesheet" href="styles8.css" />

    <link rel="stylesheet" href="styles13.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img src="icon.png" alt="Logo" class="logo-icon" />
        University Timetable
      </div>
      <nav class="nav-links">
        <a href="first.html">Home</a>
        <a onclick="showAbout()">About</a>
        <a onclick="showContact()">Contact</a>
      </nav>
    </header>

    <!-- About Modal -->
    <div id="aboutModal" class="popup-overlay">
      <div class="popup-content">
        <button class="popup-close" onclick="closeModal('aboutModal')">
          ×
        </button>
        <h2>About This Website</h2>
        <p>
          This web page displays a provisional timetable for B.Tech students at
          JNTUH College of Engineering Hyderabad.
        </p>
      </div>
    </div>
    <!-- Contact Modal -->
    <div id="contactModal" class="popup-overlay">
      <div class="popup-content">
        <button class="popup-close" onclick="closeModal('contactModal')">
          ×
        </button>
        <h2>Contact Us</h2>
        <p><strong>Name:</strong> SHAIK FAYAZ</p>
        <p><strong>Email:</strong> sahaikfayaz73822@gmail.com</p>
        <p>
          <strong>Address:</strong> Dept. of CSE, JNTUH, Hyderabad, Kukatpally
        </p>
      </div>
    </div>

    <div class="container">
      <!-- Menu -->
      <div class="menu-container">
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
        <div id="menuItems" class="menu-items">
          <button class="menu-btn" onclick="openAddSubjectPopup()">
            Add Subject
          </button>
          <button class="menu-btn" onclick="goToCT2()">
            Assign Faculty to Subjects
          </button>
          <button class="menu-btn" onclick="goToCT3()">View Timetable</button>
          <button class="menu-btn" onclick="goToCT4('Add Students')">
            Add Students
          </button>
        </div>
      </div>

      <h2>Manage Timetable</h2>
      <div id="semesterSection">Semester: 3-1 | Section: Regular</div>

      <!-- Timetable -->
      <table id="timetable">
        <thead>
          <tr>
            <th>Day</th>
            <th>9:30 AM –11:00 AM<br /><small>(2 sections)</small></th>
            <th>11:00 AM –12:30 PM</th>
            <th>1:45 PM –3:15 PM<br /><small>(2 sections)</small></th>
            <th>3:15 PM –4:45 PM</th>
          </tr>
        </thead>
        <tbody>
          <!-- Monday -->
          <tr>
            <td>Monday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
          <!-- Tuesday -->
          <tr>
            <td>Tuesday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
          <!-- Wednesday -->
          <tr>
            <td>Wednesday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select id="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
          <!-- Thursday -->
          <tr>
            <td>Thursday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
          <!-- Friday -->
          <tr>
            <td>Friday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
          <!-- Saturday -->
          <tr>
            <td>Saturday</td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
            <td class="slot two-slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
                <input type="checkbox" class="two-section-checkbox" />
              </div>
            </td>
            <td class="slot">
              <div class="cell-group">
                <select class="subjectDropdown">
                  <option value="">Select Subject</option>
                </select>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="footer">
        <button onclick="window.history.back()">Back</button>
        <button onclick="saveTimetable()">Save</button>
      </div>
    </div>

    <!-- Add Subject Popup -->
    <div id="addSubjectPopup" class="popup-overlay">
      <div class="popup-content">
        <button class="popup-close" onclick="closeAddSubjectPopup()">×</button>
        <h3>Add New Subject</h3>
        <input type="text" id="newSubjectName" placeholder="Subject Name" />
        <button onclick="saveNewSubject()">Save</button>
      </div>
    </div>

    <script>
      function toggleMenu() {
        const m = document.getElementById("menuItems");
        m.style.display = m.style.display === "block" ? "none" : "block";
      }

      function goToCT2() {
        const params = getQueryParams();
        const url = new URL("hodCT2.html", window.location.href);
        url.search = new URLSearchParams(params).toString();
        window.location.href = url.toString();
      }

      function goToCT3() {
        const params = getQueryParams();
        const url = new URL("hodCT3.html", window.location.href);
        url.search = new URLSearchParams(params).toString();
        window.location.href = url.toString();
      }

      function goToCT4() {
        const params = getQueryParams();
        const url = new URL("student_list.html", window.location.href);
        url.search = new URLSearchParams(params).toString();
        window.location.href = url.toString();
      }
      function openAddSubjectPopup() {
        document.getElementById("addSubjectPopup").style.display = "flex";
      }
      function closeAddSubjectPopup() {
        document.getElementById("addSubjectPopup").style.display = "none";
      }
      // Function to get query parameters from the URL
      function getQueryParams() {
        const urlParams = new URLSearchParams(window.location.search);
        return {
          semester: urlParams.get("semester"),
          class: urlParams.get("class"),
          room: urlParams.get("room"),
          department: urlParams.get("department"),
        };
      }

      function saveNewSubject() {
        const name = document.getElementById("newSubjectName").value.trim();
        if (!name) return alert("Please enter a subject name.");

        const params = getQueryParams();
        fetch("save_subject.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            subject: name,
            semester: params.semester,
            class: params.class,
            room: params.room,
            department: params.department,
          }).toString(),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Subject saved successfully!");
              closeAddSubjectPopup();
            } else {
              alert("Error saving subject.");
            }
          })
          .catch((error) => alert("Error: " + error));
      }
      function showAbout() {
        document.getElementById("aboutModal").style.display = "flex";
      }
      function showContact() {
        document.getElementById("contactModal").style.display = "flex";
      }
      function closeModal(id) {
        document.getElementById(id).style.display = "none";
      }
      window.onclick = function (e) {
        if (e.target.classList.contains("popup-overlay")) {
          e.target.style.display = "none";
        }
      };
      document.querySelectorAll(".two-section-checkbox").forEach((cb) => {
        cb.addEventListener("change", function () {
          const cell = this.closest("td"),
            row = cell.parentElement,
            idx = Array.from(row.children).indexOf(cell);
          if (this.checked) {
            const right = row.children[idx + 1];
            cell.colSpan = 2;
            right.remove();
          } else {
            cell.removeAttribute("colSpan");
            const clone = cell.cloneNode(true);
            clone.querySelector(".two-section-checkbox").checked = false;
            row.insertBefore(clone, row.children[idx + 1]);
          }
        });
      });
      document.addEventListener("DOMContentLoaded", function () {
        fetch("get_subjects.php")
          .then((response) => response.json())
          .then((subjects) => {
            const dropdowns = document.querySelectorAll(".subjectDropdown");
            dropdowns.forEach((dropdown) => {
              subjects.forEach((subject) => {
                const option = document.createElement("option");
                option.value = subject;
                option.textContent = subject;
                dropdown.appendChild(option);
              });
            });
          })
          .catch((error) => console.error("Error loading subjects:", error));
      });
    </script>
  </body>
</html>
